(this["webpackJsonpeditor-frontend"]=this["webpackJsonpeditor-frontend"]||[]).push([[0],{227:function(e,t,s){},254:function(e,t,s){},255:function(e,t,s){"use strict";s.r(t);var n=s(2),a=s.n(n),r=s(46),c=s.n(r),o=s(1),l=s.n(o),u=s(11),i=s(92),d=s(93),m=s(97),h=s(96),p=s(94),f=s.n(p),j=(s(207),s(0)),g=function(e){return e.token?Object(j.jsxs)("div",{children:[Object(j.jsxs)("div",{children:[e.currentUser," is logged in"]}),Object(j.jsx)("button",{onClick:e.logout,children:"Log out"})]}):Object(j.jsx)("div",{className:"AuthForm",children:Object(j.jsxs)("form",{children:[Object(j.jsx)("label",{children:"Email"}),Object(j.jsx)("input",{className:"email",type:"email",defaultValue:"joki20@student.bth.se"}),Object(j.jsx)("label",{children:"Password"}),Object(j.jsx)("input",{className:"password",defaultValue:"abc123"}),Object(j.jsx)("input",{type:"submit",className:"register",value:"Register",onClick:e.handleRegister}),Object(j.jsx)("input",{type:"submit",className:"login",value:"Login",onClick:e.handleLogin})]})})},b=function(e){return Object(j.jsxs)("div",{className:"Toolbar",children:[Object(j.jsx)(g,{handleRegister:e.handleRegister,handleLogin:e.handleLogin,token:e.token,currentUser:e.currentUser,logout:e.logout}),Object(j.jsx)("button",{onClick:e.saveContent,children:"SAVE DOC"}),Object(j.jsx)("div",{className:"clickedStatus",children:e.messageStatus})]})},w=function(e){return Object(j.jsxs)("div",{className:"ListDocs",children:[Object(j.jsx)("h2",{children:"Documents"}),Object(j.jsx)("ul",{children:e.listDocs.map((function(t){return Object(j.jsx)("li",{onClick:e.clickTitle,name:t.id,children:t.title},t.id)}))})]})},x=function(e){var t=0;return Object(j.jsxs)("div",{className:"ListUsers",children:[Object(j.jsx)("h2",{children:"Allowed users"}),Object(j.jsx)("ul",{children:e.allowedUsers.map((function(e){return Object(j.jsx)("li",{children:e},++t)}))})]})},v=function(e){var t=0;return Object(j.jsxs)("div",{className:"AddUsers",children:[Object(j.jsx)("h2",{children:"Add user"}),Object(j.jsx)("ul",{children:e.unallowedUsers.map((function(s){return Object(j.jsx)("li",{onClick:e.allowUser,children:s},++t)}))})]})},O=function(e){return Object(j.jsxs)("div",{className:"Title",children:[Object(j.jsx)("h2",{children:"Title"}),Object(j.jsx)("input",{className:"titleInput","aria-label":"inputLable"})]})},k=s(12),S=s.n(k),U=(s(227),s(228),s(95)),C="https://jsramverk-editor-joki20.azurewebsites.net",D=s.n(U)()("http://student.bth.se"),y=function(e){Object(m.a)(s,e);var t=Object(h.a)(s);function s(e){var n;return Object(i.a)(this,s),(n=t.call(this,e)).getDocs=Object(u.a)(l.a.mark((function e(){var t,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return[],t=[],s=[],console.log("call axios"),e.next=6,S()({url:"".concat(C,"/graphql/"),method:"post",data:{query:"\n                {\n                    users {\n                        email\n                        docs {\n                            id\n                            title\n                            content\n                            allowed_users {\n                                email\n                            }\n                        }\n                    }\n                }\n                "}}).then((function(e){e.data.data.users.forEach((function(e){t.push(e.email),e.docs.forEach((function(e){e.allowed_users.forEach((function(t){console.log("ALLOWED TO EDIT: "),console.log(t),t.email==n.state.currentUser&&s.push(e)}))}))}))}));case 6:return e.next=8,n.setState({allowedDocs:s});case 8:return e.next=10,n.setState({allUsers:t});case 10:case"end":return e.stop()}}),e)}))),n.postDatabase=function(e){S.a.post("".concat(C,"/create"),{email:n.state.currentUser,title:e,content:n.state.currentContent}),n.getDocs()},n.updateDatabase=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.a.post("".concat(C,"/update/"),{docOwner:n.state.clickedDocOwner,docId:n.state.clickedDocId,content:n.state.currentContent}).then((function(e){return e.status})).catch((function(e){return console.warn(e)}));case 2:case"end":return e.stop()}}),e)}))),n.getCurrentInput=function(e){n.setState({currentContent:e});var t=document.getElementsByClassName("titleInput")[0].value,s=null;n.state.allowedDocs.forEach((function(e){e.title===t&&(s=e._id)}));var a={_id:s,html:n.state.currentContent};D.emit("create",a),D.on("doc",(function(e){n.setState({currentContent:e.html})}))},n.getCurrentTitle=function(e){n.setState({currentTitle:e})},n.clickTitle=function(){var e=Object(u.a)(l.a.mark((function e(t){var s,a,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.target.innerHTML,a=[],r=[],console.log("CLICKED TITLE"),console.log(t),e.next=7,n.state.allowedDocs.forEach((function(e){e.title===s&&(console.log(e),document.getElementsByClassName("titleInput")[0].value=e.title,n.setState({currentTitle:e.title}),n.setState({currentContent:e.content}),e.allowed_users.forEach((function(e){a.push(e.email)})),console.log("RAD 150"),console.log(a),n.setState({allowedUsers:a}),n.setState({clickedDocId:e.id}),n.setState({clickedDocOwner:e.allowed_users[0]}))}));case 7:return e.next=9,n.state.allUsers.forEach((function(e){n.state.allowedUsers.includes(e)||r.push(e)}));case 9:n.setState({unallowedUsers:r});case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.save=Object(u.a)(l.a.mark((function e(){var t,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t="no",""!=n.state.token){e.next=3;break}return e.abrupt("return",n.setState({messageStatus:"You must be logged in"}));case 3:if(s=document.getElementsByClassName("titleInput")[0].value,null,s){e.next=7;break}return e.abrupt("return",n.setState({messageStatus:"You must provide a title"}));case 7:if(n.state.allowedDocs.forEach((function(e){e.title===s&&(n.setState({clickedDocId:e.id}),n.setState({clickedDocOwner:e.allowed_users[0].name}),n.setState({messageStatus:"Title content updated"}),t="yes",e.id,n.updateDatabase())})),"no"!==t){e.next=13;break}return console.log("Title doesn't exist"),n.setState({messageStatus:"New entry created"}),e.next=13,n.postDatabase(s);case 13:case"end":return e.stop()}}),e)}))),n.register=function(){var e=Object(u.a)(l.a.mark((function e(t){var s,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),s=document.getElementsByClassName("email")[0].value,a=document.getElementsByClassName("password")[0].value,e.next=5,S.a.post("".concat(C,"/register"),{email:s,password:a});case 5:return document.getElementsByClassName("email")[0].value="",document.getElementsByClassName("password")[0].value="",e.abrupt("return",n.setState({messageStatus:"".concat(s," was added, try to login")}));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.login=function(){var e=Object(u.a)(l.a.mark((function e(t){var s,a,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),s=document.getElementsByClassName("email")[0].value,a=document.getElementsByClassName("password")[0].value,r="no",n.setState({currentUser:s}),s&&a){e.next=7;break}return e.abrupt("return",n.setState({messageStatus:"Email or password missing"}));case 7:return e.next=9,S.a.get("".concat(C,"/users")).then((function(e){e.data.data[0].Users.forEach((function(e){console.log(e.email),e.email===s&&(r="yes")}))}));case 9:if("no"===r&&n.setState({messageStatus:"Sorry, but email doesn't exist"}),"yes"!==r){e.next=14;break}return console.log("matching email was found"),e.next=14,S.a.post("".concat(C,"/login"),{email:s,password:a}).then((function(e){e.data.data&&n.setState({token:e.data.data})})).catch((function(e){return console.warn(e)}));case 14:n.getDocs(),n.setState({messageStatus:""});case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.logout=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.setState({currentUser:""}),n.setState({token:""}),n.setState({allowedDocs:[]}),n.setState({allowedUsers:[]}),n.setState({unallowedPersons:[]}),n.setState({currentTitle:""}),n.setState({currentContent:""}),document.getElementsByClassName("titleInput")[0].value="";case 8:case"end":return e.stop()}}),e)}))),n.allowUser=function(){var e=Object(u.a)(l.a.mark((function e(t){var s,a,r,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),s=t.target.innerHTML,console.log("clicked user to remove:"),console.log(s),e.next=6,S.a.post("".concat(C,"/allow_user"),{email:s,currentUser:n.state.currentUser,docId:n.state.clickedDocId});case 6:return(a=n.state.allowedUsers).push(s),n.setState({allowedUsers:a}),r=n.state.unallowedUsers.indexOf(s),(c=n.state.unallowedUsers).splice(r,1),n.setState({unallowedUsers:c}),e.abrupt("return",n.setState({messageStatus:"".concat(s," is now allowed to edit this document")}));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.state={allUsers:[],allowedDocs:[],allowedUsers:[],unallowedUsers:[],currentTitle:"",currentContent:"",messageStatus:"",token:"",currentUser:"",clickedDocId:"",clickedDocOwner:""},n}return Object(d.a)(s,[{key:"socketUpdateContent",value:function(e){this.setState({currentContent:e})}},{key:"render",value:function(){return Object(j.jsxs)("div",{className:"App",children:[Object(j.jsx)(b,{saveContent:this.save,messageStatus:this.state.messageStatus,handleRegister:this.register,handleLogin:this.login,token:this.state.token,currentUser:this.state.currentUser,logout:this.logout}),Object(j.jsx)(O,{onChange:this.getCurrentTitle}),Object(j.jsx)(w,{listDocs:this.state.allowedDocs,clickTitle:this.clickTitle}),Object(j.jsx)(x,{allowedUsers:this.state.allowedUsers}),Object(j.jsx)(v,{allUsers:this.state.allUsers,unallowedUsers:this.state.unallowedUsers,allowUser:this.allowUser}),Object(j.jsx)(f.a,{className:"Quill",theme:"snow",value:this.state.currentContent,onChange:this.getCurrentInput})]})}}]),s}(a.a.Component),E=y;s(254);c.a.render(Object(j.jsx)(E,{}),document.getElementById("root"))}},[[255,1,2]]]);
//# sourceMappingURL=main.db520037.chunk.js.map